(function(Countly){var SDK_VERSION="1.0.1";var SDK_NAME="omt_web_sdk";var inited=false,sessionStarted=false,apiPath="/i",beatInterval=500,queueSize=1e3,requestQueue=[],eventQueue=[],crashLogs=[],timedEvents={},ignoreReferrers=[],crashSegments=null,autoExtend=true,lastBeat,storedDuration=0,lastView=null,lastViewTime=0,lastViewStoredDuration=0,failTimeout=0,failTimeoutAmount=60,inactivityTime=20,inactivityCounter=0,sessionUpdate=60,maxEventBatch=10,maxCrashLogs=100,lastMsTs=0,readyToProcess=true,platform,hasPulse=false,syncConsents={},lastParams={},urlParseRE=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,searchBotRE=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO)/,trackTime=true,startTime;Countly.features=["sessions","events","views","scrolls","clicks","forms","crashes","attribution","users","star-rating","location"];var consents={};for(var i=0;i<Countly.features.length;i++){consents[Countly.features[i]]={}}Countly.init=function(ob,requireConsent){if(!inited){startTime=getTimestamp();inited=true;requestQueue=store("omt_queue")||[];timedEvents={};eventQueue=store("omt_event")||[];ob=ob||{};beatInterval=ob.interval||Countly.interval||beatInterval;queueSize=ob.queue_size||Countly.queue_size||queueSize;failTimeoutAmount=ob.fail_timeout||Countly.fail_timeout||failTimeoutAmount;inactivityTime=ob.inactivity_time||Countly.inactivity_time||inactivityTime;sessionUpdate=ob.session_update||Countly.session_update||sessionUpdate;maxEventBatch=ob.max_events||Countly.max_events||maxEventBatch;maxCrashLogs=ob.max_logs||Countly.max_logs||maxCrashLogs;Countly.ignore_prefetch=ob.ignore_prefetch||Countly.ignore_prefetch||true;Countly.debug=ob.debug||Countly.debug||false;Countly.app_key=ob.app_key||Countly.app_key||null;Countly.device_id=ob.device_id||Countly.device_id||getId();Countly.url=stripTrailingSlash(ob.url||Countly.url||"");Countly.app_version=ob.app_version||Countly.app_version||"0.0";Countly.country_code=ob.country_code||Countly.country_code||null;Countly.city=ob.city||Countly.city||null;Countly.ip_address=ob.ip_address||Countly.ip_address||null;Countly.ignore_bots=ob.ignore_bots||Countly.ignore_bots||true;Countly.force_post=ob.force_post||Countly.force_post||false;Countly.q=Countly.q||[];Countly.onload=Countly.onload||[];Countly.ignore_visitor=ob.ignore_visitor||Countly.ignore_visitor||false;Countly.require_consent=ob.require_consent||Countly.require_consent||false;if(ob.ignore_referrers&&ob.ignore_referrers.constructor===Array){ignoreReferrers=ob.ignore_referrers}else if(Countly.ignore_referrers&&Countly.ignore_referrers.constructor===Array){ignoreReferrers=Countly.ignore_referrers}if(Countly.url===""){log("Please provide server URL");Countly.ignore_visitor=true}if(store("omt_ignore")){Countly.ignore_visitor=true}checkIgnore();if(window.name&&window.name.indexOf("cly:")===0){try{Countly.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(ex){log("Could not parse name",window.name)}}else if(location.hash&&location.hash.indexOf("#cly:")===0){try{Countly.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(ex){log("Could not parse hash",location.hash)}}if(Countly.passed_data){if(Countly.passed_data.token&&Countly.passed_data.purpose){if(Countly.passed_data.token!==store("omt_old_token")){setToken(Countly.passed_data.token);store("omt_old_token",Countly.passed_data.token)}if(Countly.passed_data.purpose==="heatmap"){Countly.ignore_visitor=true;showLoader();loadJS(Countly.url+"/views/heatmap.js",hideLoader)}}}if(!Countly.ignore_visitor){log("Countly initialized");if(Countly.onload.constructor!==Array){Countly.onload=[]}if(Countly.q.constructor!==Array){Countly.q=[]}heartBeat();store("omt_id",Countly.device_id);var i=0;Countly.utm=Countly.utm||{source:true,medium:true,campaign:true,term:true,content:true};if(location.search){var parts=location.search.substring(1).split("&");var utms={};var hasUTM=false;for(i=0;i<parts.length;i++){var nv=parts[i].split("=");if(nv[0]==="omt_id"){store("omt_cmp_id",nv[1])}else if(nv[0]==="omt_uid"){store("omt_cmp_uid",nv[1])}else if((nv[0]+"").indexOf("utm_")===0&&Countly.utm[nv[0].replace("utm_","")]){utms[nv[0].replace("utm_","")]=nv[1];hasUTM=true}}if(hasUTM){for(var tag in Countly.utm){if(utms[tag]){Countly.userData.set("utm_"+tag,utms[tag])}else{Countly.userData.unset("utm_"+tag)}}Countly.userData.save()}}notifyLoaders()}}};Countly.group_features=function(features){if(features){var ob;for(var i in features){ob={};if(!consents[i]){if(typeof features[i]==="string"){consents[i]={features:[features[i]]}}else if(features[i]&&features[i].constructor===Array&&features[i].length){consents[i]={features:features[i]}}else{log("Incorrect feature list for "+i+" value: "+features[i])}}else{log("Feature name "+i+" is already reserved")}}}else{log("Incorrect features: "+features)}};Countly.check_consent=function(feature){if(!Countly.require_consent){return true}if(consents[feature]){return consents[feature]&&consents[feature].optin?true:false}else{log("No feature available for "+feature)}return false};Countly.check_any_consent=function(){if(!Countly.require_consent){return true}for(var i in consents){if(consents[i]&&consents[i].optin){return true}}return false};Countly.add_consent=function(feature){log("Adding consent for "+feature);if(feature.constructor===Array){for(var i=0;i<feature.length;i++){Countly.add_consent(feature[i])}}else if(consents[feature]){if(consents[feature].features){consents[feature].optin=true;Countly.add_consent(consents[feature].features)}else{if(consents[feature].optin!==true){syncConsents[feature]=true;consents[feature].optin=true;updateConsent();setTimeout(function(){if(feature==="sessions"&&lastParams.begin_session){Countly.begin_session.apply(Countly,lastParams.begin_session);lastParams.begin_session=null}else if(feature==="views"&&lastParams.track_pageview){lastView=null;Countly.track_pageview.apply(Countly,lastParams.track_pageview);lastParams.track_pageview=null}if(lastParams.change_id){Countly.change_id.apply(Countly,lastParams.change_id);lastParams.change_id=null}},1)}}}else{log("No feature available for "+feature)}};Countly.remove_consent=function(feature){log("Removing consent for "+feature);if(feature.constructor===Array){for(var i=0;i<feature.length;i++){Countly.remove_consent(feature[i])}}else if(consents[feature]){if(consents[feature].features){Countly.remove_consent(consents[feature].features)}else{if(consents[feature].optin!==false){syncConsents[feature]=false;updateConsent()}}consents[feature].optin=false}else{log("No feature available for "+feature)}};var consentTimer;var updateConsent=function(){if(consentTimer){clearTimeout(consentTimer);consentTimer=null}consentTimer=setTimeout(function(){if(hasAnyProperties(syncConsents)){toRequestQueue({consent:JSON.stringify(syncConsents)});syncConsents={}}},1e3)};Countly.begin_session=function(noHeartBeat){if(Countly.check_consent("sessions")){if(!sessionStarted){log("Session started");lastBeat=getTimestamp();sessionStarted=true;autoExtend=noHeartBeat?false:true;var req={};req.begin_session=1;req.metrics=JSON.stringify(getMetrics());toRequestQueue(req)}}else{lastParams.begin_session=arguments}};Countly.session_duration=function(sec){if(Countly.check_consent("sessions")){if(sessionStarted){log("Session extended",sec);toRequestQueue({session_duration:sec})}}};Countly.end_session=function(sec){if(Countly.check_consent("sessions")){if(sessionStarted){sec=sec||getTimestamp()-lastBeat;log("Ending session");reportViewDuration();sessionStarted=false;toRequestQueue({end_session:1,session_duration:sec})}}};Countly.change_id=function(newId,merge){if(Countly.device_id!==newId){if(!merge){if(eventQueue.length>0){toRequestQueue({events:JSON.stringify(eventQueue)});eventQueue=[];store("omt_event",eventQueue)}Countly.end_session();timedEvents={}}var oldId=Countly.device_id;Countly.device_id=newId;store("omt_id",Countly.device_id);log("Changing id");if(merge){if(Countly.check_any_consent()){toRequestQueue({old_device_id:oldId})}else{lastParams.change_id=arguments}}else{Countly.begin_session(!autoExtend)}}};Countly.add_event=function(event){if(Countly.check_consent("events")){add_omt_events(event)}};function add_omt_events(event){if(Countly.ignore_visitor){return}if(!event.key){log("Event must have key property");return}if(!event.count){event.count=1}var props=["key","count","sum","dur","segmentation"];var e=getProperties(event,props);e.timestamp=getMsTimestamp();var date=new Date;e.hour=date.getHours();e.dow=date.getDay();eventQueue.push(e);store("omt_event",eventQueue);log("Adding event: ",event)}Countly.start_event=function(key){if(timedEvents[key]){log("Timed event with key "+key+" already started");return}timedEvents[key]=getTimestamp()};Countly.end_event=function(event){if(typeof event=="string"){event={key:event}}if(!event.key){log("Event must have key property");return}if(!timedEvents[event.key]){log("Timed event with key "+event.key+" was not started");return}event.dur=getTimestamp()-timedEvents[event.key];Countly.add_event(event);delete timedEvents[event.key]};Countly.user_details=function(user){if(Countly.check_consent("users")){log("Adding userdetails: ",user);var props=["username","nickname","mobile","segmentation"];toRequestQueue({user_details:JSON.stringify(getProperties(user,props))})}};Countly.report_conversion=function(campaign_id,campaign_user_id){if(Countly.check_consent("attribution")){campaign_id=campaign_id||store("omt_cmp_id")||"omt_organic";campaign_user_id=campaign_user_id||store("omt_cmp_uid");if(campaign_id&&campaign_user_id){toRequestQueue({campaign_id:campaign_id,campaign_user:campaign_user_id})}else if(campaign_id){toRequestQueue({campaign_id:campaign_id})}}};var customData={};var change_custom_property=function(key,value,mod){if(Countly.check_consent("users")){if(!customData[key]){customData[key]={}}if(mod==="$push"||mod==="$pull"||mod==="$addToSet"){if(!customData[key][mod]){customData[key][mod]=[]}customData[key][mod].push(value)}else{customData[key][mod]=value}}};Countly.userData={set:function(key,value){customData[key]=value},unset:function(key){customData[key]=""},set_once:function(key,value){change_custom_property(key,1,"$setOnce")},increment:function(key){change_custom_property(key,1,"$inc")},increment_by:function(key,value){change_custom_property(key,value,"$inc")},multiply:function(key,value){change_custom_property(key,value,"$mul")},max:function(key,value){change_custom_property(key,value,"$max")},min:function(key,value){change_custom_property(key,value,"$min")},push:function(key,value){change_custom_property(key,value,"$push")},push_unique:function(key,value){change_custom_property(key,value,"$addToSet")},pull:function(key,value){change_custom_property(key,value,"$pull")},save:function(){if(Countly.check_consent("users")){toRequestQueue({user_details:JSON.stringify({custom:customData})})}customData={}}};Countly.track_errors=function(segments){crashSegments=segments;window.onerror=function(msg,url,line,col,err){if(typeof err!=="undefined"){recordError(err,false)}else{col=col||window.event&&window.event.errorCharacter;var error="";if(typeof msg!=="undefined"){error+=msg+"\n"}if(typeof url!=="undefined"){error+="at "+url}if(typeof line!=="undefined"){error+=":"+line}if(typeof col!=="undefined"){error+=":"+col}error+="\n";try{var stack=[];var f=arguments.callee.caller;while(f){stack.push(f.name);f=f.caller}error+=stack.join("\n")}catch(ex){}recordError(error,false)}}};Countly.log_error=function(err,segments){recordError(err,true,segments)};Countly.add_log=function(record){if(Countly.check_consent("crashes")){if(crashLogs.length>maxCrashLogs){crashLogs.shift()}crashLogs.push(record)}};Countly.stop_time=function(){if(trackTime){trackTime=false;storedDuration=getTimestamp()-lastBeat;lastViewStoredDuration=getTimestamp()-lastViewTime}};Countly.start_time=function(){if(!trackTime){trackTime=true;lastBeat=getTimestamp()-storedDuration;lastViewTime=getTimestamp()-lastViewStoredDuration;lastViewStoredDuration=0}};Countly.track_sessions=function(){Countly.begin_session();Countly.start_time();add_event(window,"beforeunload",function(){Countly.end_session()});add_event(window,"unload",function(){Countly.end_session()});var hidden="hidden";function onchange(){if(document[hidden]){Countly.stop_time()}else{Countly.start_time()}}if(hidden in document){document.addEventListener("visibilitychange",onchange)}else if((hidden="mozHidden")in document){document.addEventListener("mozvisibilitychange",onchange)}else if((hidden="webkitHidden")in document){document.addEventListener("webkitvisibilitychange",onchange)}else if((hidden="msHidden")in document){document.addEventListener("msvisibilitychange",onchange)}else if("onfocusin"in document){add_event(window,"focusin",function(){Countly.start_time()});add_event(window,"focusout",function(){Countly.stop_time()})}else{add_event(window,"focus",function(){Countly.start_time()});add_event(window,"blur",function(){Countly.stop_time()});add_event(window,"pageshow",function(){Countly.start_time()});add_event(window,"pagehide",function(){Countly.stop_time()})}function resetInactivity(){if(inactivityCounter>=inactivityTime){Countly.start_time()}inactivityCounter=0}add_event(window,"mousemove",resetInactivity);add_event(window,"click",resetInactivity);add_event(window,"keydown",resetInactivity);add_event(window,"scroll",resetInactivity);setInterval(function(){inactivityCounter++;if(inactivityCounter>=inactivityTime){Countly.stop_time()}},6e4)};Countly.track_pageview=function(page,ignoreList){reportViewDuration();if(page&&page.constructor===Array){ignoreList=page;page=null}page=page||window.document.location.toString();if(ignoreList&&ignoreList.length){for(var i=0;i<ignoreList.length;i++){try{var reg=new RegExp(ignoreList[i]);if(reg.test(page)){log("Ignored:",page);return}}catch(ex){log("Problem with regex",ignoreList[i])}}}lastView=page;lastViewTime=getTimestamp();var segments={name:page,visit:1,domain:window.location.hostname,page_title:document.title,referrer_page:getReferrer()};if(typeof document.referrer!=="undefined"&&document.referrer.length){var matches=urlParseRE.exec(document.referrer);if(matches&&matches[11]&&matches[11]!==window.location.hostname){segments.start=1}}if(Countly.check_consent("views")){add_omt_events({key:"[OMT]_view",segmentation:segments})}else{lastParams.track_pageview=arguments}};Countly.track_view=function(page,ignoreList){Countly.track_pageview(page,ignoreList)};Countly.track_clicks=function(parent){parent=parent||document;var shouldProcess=true;function processClick(event){if(shouldProcess){shouldProcess=false;get_page_coord(event);if(typeof event.pageX!=="undefined"&&typeof event.pageY!=="undefined"){var height=getDocHeight();var width=getDocWidth();if(Countly.check_consent("clicks")){add_omt_events({key:"[OMT]_click",segmentation:{type:"click",x:event.pageX,y:event.pageY,width:width,height:height,domain:window.location.hostname,view:window.top.document.location.toString()}})}}setTimeout(function(){shouldProcess=true},1e3)}}add_event(parent,"click",processClick)};Countly.track_scrolls=function(parent){parent=parent||window;var shouldProcess=true;var scrollY=0;function processScroll(event){scrollY=Math.max(scrollY,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)}function processScrollView(e){if(shouldProcess){shouldProcess=false;var height=getDocHeight();var width=getDocWidth();var viewportHeight=getViewportHeight();if(Countly.check_consent("scrolls")){add_omt_events({key:"[CLY]_action",segmentation:{type:"scroll",y:scrollY+viewportHeight,width:width,height:height,domain:window.location.hostname,view:window.location.pathname}})}}}add_event(parent,"scroll",processScroll);add_event(parent,"beforeunload",processScrollView);add_event(parent,"unload",processScrollView)};Countly.track_links=function(parent){parent=parent||document;function processClick(event){var elem=get_event_target(event).closest("a");if(elem){get_page_coord(event);if(Countly.check_consent("clicks")){add_omt_events({key:"[OMT]_link_click",segmentation:{href:elem.href,text:elem.innerText,id:elem.id,x:event.pageX,y:event.pageY,view:window.top.document.location.toString()}})}}}add_event(parent,"click",processClick)};Countly.track_forms=function(parent){parent=parent||document;function getInputName(input){return input.name||input.id||input.type||input.nodeName}function processForm(event){var form=get_event_target(event);var segmentation={id:form.id,name:form.name,action:form.action,method:form.method,view:window.top.document.location.toString()};var input;if(typeof form.elements!=="undefined"){for(var i=0;i<form.elements.length;i++){input=form.elements[i];if(input&&input.type!=="password"){if(typeof segmentation["input:"+getInputName(input)]==="undefined"){segmentation["input:"+getInputName(input)]=[]}if(input.nodeName.toLowerCase()==="select"){if(typeof input.multiple!=="undefined"){segmentation["input:"+getInputName(input)].push(getMultiSelectValues(input))}else{segmentation["input:"+getInputName(input)].push(input.options[input.selectedIndex].value)}}else if(input.nodeName.toLowerCase()==="input"){if(typeof input.type!=="undefined"){if(input.type.toLowerCase()==="checkbox"||input.type.toLowerCase()==="radio"){if(input.checked){segmentation["input:"+getInputName(input)].push(input.value)}}else{segmentation["input:"+getInputName(input)].push(input.value)}}else{segmentation["input:"+getInputName(input)].push(input.value)}}else if(input.nodeName.toLowerCase()==="textarea"){segmentation["input:"+getInputName(input)].push(input.value)}else if(typeof input.value!=="undefined"){segmentation["input:"+getInputName(input)].push(input.value)}}}for(var key in segmentation){if(typeof segmentation[key].join!="undefined"){segmentation[key]=segmentation[key].join(", ")}}}if(Countly.check_consent("forms")){add_omt_events({key:"[OMT]_form_submit",segmentation:segmentation})}}add_event(parent,"submit",processForm)};Countly.collect_from_forms=function(parent,useCustom){parent=parent||document;function processForm(event){var form=get_event_target(event);var userdata={};var hasUserInfo=false;var input;if(typeof form.elements!=="undefined"){var labelData={};var labels=parent.getElementsByTagName("LABEL");var i,j;for(i=0;i<labels.length;i++){if(labels[i].htmlFor&&labels[i].htmlFor!==""){labelData[labels[i].htmlFor]=labels[i].innerText||labels[i].textContent||labels[i].innerHTML}}for(i=0;i<form.elements.length;i++){input=form.elements[i];if(input&&input.type!=="password"){if(input.className.indexOf("omt_user_ignore")===-1){var value="";if(input.nodeName.toLowerCase()==="select"){if(typeof input.multiple!=="undefined"){value=getMultiSelectValues(input)}else{value=input.options[input.selectedIndex].value}}else if(input.nodeName.toLowerCase()==="input"){if(typeof input.type!=="undefined"){if(input.type.toLowerCase()==="checkbox"||input.type.toLowerCase()==="radio"){if(input.checked){value=input.value}}else{value=input.value}}else{value=input.value}}else if(input.nodeName.toLowerCase()==="textarea"){value=input.value}else if(typeof input.value!=="undefined"){value=input.value}if(input.className&&input.className.indexOf("omt_user_")!==-1){var classes=input.className.split(" ");for(j=0;j<classes.length;j++){if(classes[j].indexOf("omt_user_")===0){userdata[classes[j].replace("omt_user_","")]=value;hasUserInfo=true;break}}}else if(input.type&&input.type.toLowerCase()==="email"||input.name&&input.name.toLowerCase().indexOf("email")!==-1||input.id&&input.id.toLowerCase().indexOf("email")!==-1||input.id&&labelData[input.id]&&labelData[input.id].toLowerCase().indexOf("email")!==-1||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(value)){if(!userdata.email){userdata.email=value}hasUserInfo=true}else if(input.name&&input.name.toLowerCase().indexOf("username")!==-1||input.id&&input.id.toLowerCase().indexOf("username")!==-1||input.id&&labelData[input.id]&&labelData[input.id].toLowerCase().indexOf("username")!==-1){if(!userdata.username){userdata.username=value}hasUserInfo=true}else if(input.name&&(input.name.toLowerCase().indexOf("tel")!==-1||input.name.toLowerCase().indexOf("phone")!==-1||input.name.toLowerCase().indexOf("number")!==-1)||input.id&&(input.id.toLowerCase().indexOf("tel")!==-1||input.id.toLowerCase().indexOf("phone")!==-1||input.id.toLowerCase().indexOf("number")!==-1)||input.id&&labelData[input.id]&&(labelData[input.id].toLowerCase().indexOf("tel")!==-1||labelData[input.id].toLowerCase().indexOf("phone")!==-1||labelData[input.id].toLowerCase().indexOf("number")!==-1)){if(!userdata.phone){userdata.phone=value}hasUserInfo=true}else if(input.name&&(input.name.toLowerCase().indexOf("org")!==-1||input.name.toLowerCase().indexOf("company")!==-1)||input.id&&(input.id.toLowerCase().indexOf("org")!==-1||input.id.toLowerCase().indexOf("company")!==-1)||input.id&&labelData[input.id]&&(labelData[input.id].toLowerCase().indexOf("org")!==-1||labelData[input.id].toLowerCase().indexOf("company")!==-1)){if(!userdata.organization){userdata.organization=value}hasUserInfo=true}else if(input.name&&input.name.toLowerCase().indexOf("name")!==-1||input.id&&input.id.toLowerCase().indexOf("name")!==-1||input.id&&labelData[input.id]&&labelData[input.id].toLowerCase().indexOf("name")!==-1){if(!userdata.name){userdata.name=""}userdata.name+=value+" ";hasUserInfo=true}}}}}if(hasUserInfo){log("Gathered user data",userdata);if(useCustom){Countly.user_details({custom:userdata})}else{Countly.user_details(userdata)}}}add_event(parent,"submit",processForm)};Countly.collect_from_facebook=function(custom){if(FB&&FB.api){FB.api("/me",function(resp){var data={};if(resp.name){data.name=resp.name}if(resp.email){data.email=resp.email}if(resp.gender==="male"){data.gender="M"}else if(resp.gender==="female"){data.gender="F"}if(resp.birthday){var byear=resp.birthday.split("/").pop();if(byear&&byear.length===4){data.byear=byear}}if(resp.work&&resp.work[0]&&resp.work[0].employer&&resp.work[0].employer.name){data.organization=resp.work[0].employer.name}if(custom){data.custom={};for(var i in custom){var parts=custom[i].split(".");var get=resp;for(var j=0;j<parts.length;j++){get=get[parts[j]];if(typeof get==="undefined"){break}}if(typeof get!=="undefined"){data.custom[i]=get}}}Countly.user_details(data)})}};Countly.opt_out=function(){Countly.ignore_visitor=true;store("omt_ignore",true)};Countly.opt_in=function(){store("omt_ignore",false);Countly.ignore_visitor=false;checkIgnore();if(!Countly.ignore_visitor&&!hasPulse){heartBeat()}};Countly.show_feedback_popup=function(id){sendXmlHttpRequest(Countly.url+"/o/feedback/widget",{widget_id:id},function(err,params,responseText){if(err){log("Error occurred",err)}try{var currentWidget=JSON.parse(responseText);processWidget(currentWidget,false)}catch(JSONParseError){log("JSON parse failed: "+JSONParseError)}})};Countly.enable_feedback=function(params){loadCSS(Countly.url+"/star-rating/stylesheets/countly-feedback-web.css");var enableWidgets=params.popups||params.widgets;if(enableWidgets.length>0){document.body.innerHTML+='<div id="cfbg"></div>';sendXmlHttpRequest(Countly.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(enableWidgets)},function(err,params,responseText){if(err){log("Errors occurred:",err)}try{var widgets=JSON.parse(responseText);for(var i=0;i<widgets.length;i++){var target_devices=widgets[i].target_devices;var currentDevice=detect_device.device;if(target_devices[currentDevice]){var pages=widgets[i].target_pages;for(var k=0;k<pages.length;k++){widgets[i].hide_sticker=widgets[i].hide_sticker==="true"?true:false;if(pages[k]===window.location.pathname&&!widgets[i].hide_sticker){processWidget(widgets[i],true)}}}}}catch(JSONParseError){log("JSON parse error: "+JSONParseError)}})}else{log("You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")}};function checkIgnore(){if(Countly.ignore_prefetch&&typeof document.visibilityState!=="undefined"&&document.visibilityState==="prerender"){Countly.ignore_visitor=true}if(Countly.ignore_bots&&searchBotRE.test(navigator.userAgent)){Countly.ignore_visitor=true}}function getMultiSelectValues(input){var values=[];if(typeof input.options!=="undefined"){for(var j=0;j<input.options.length;j++){if(input.options[j].selected){values.push(input.options[j].value)}}}return values.join(", ")}function notifyLoaders(){var i;if(typeof Countly.onload!=="undefined"&&Countly.onload.length>0){for(i=0;i<Countly.onload.length;i++){if(typeof Countly.onload[i]==="function"){Countly.onload[i]()}}Countly.onload=[]}}function processWidget(currentWidget,hasSticker){try{var wrapper=document.createElement("div");wrapper.className="countly-iframe-wrapper";wrapper.id="countly-iframe-wrapper-"+currentWidget._id;var closeIcon=document.createElement("span");closeIcon.className="countly-feedback-close-icon";closeIcon.id="countly-feedback-close-icon-"+currentWidget._id;closeIcon.innerHTML="x";var iframe=document.createElement("iframe");iframe.name="countly-feedback-iframe";iframe.id="countly-feedback-iframe";iframe.src=Countly.url+"/feedback?widget_id="+currentWidget._id+"&app_key="+Countly.app_key+"&device_id="+Countly.device_id+"&sdk_version="+SDK_VERSION;document.body.appendChild(wrapper);wrapper.appendChild(closeIcon);wrapper.appendChild(iframe);add_event(document.getElementById("countly-feedback-close-icon-"+currentWidget._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+currentWidget._id).style.display="none";document.getElementById("cfbg").style.display="none"});if(hasSticker){var sticker=document.createElement("div");sticker.style.color=currentWidget.trigger_font_color<7?"#"+currentWidget.trigger_font_color:currentWidget.trigger_font_color;sticker.style.backgroundColor=currentWidget.trigger_bg_color.length<7?"#"+currentWidget.trigger_bg_color:currentWidget.trigger_bg_color;sticker.className="countly-feedback-sticker "+currentWidget.trigger_position;sticker.id="countly-feedback-sticker-"+currentWidget._id;sticker.innerHTML='<svg id="feedback-sticker-svg" aria-hidden="true" data-prefix="far" data-icon="grin" class="svg-inline--fa fa-grin fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path id="smileyPathInStickerSvg" fill="white" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z"></path></svg> '+currentWidget.trigger_button_text;document.body.appendChild(sticker);var smileySvg=document.getElementById("smileyPathInStickerSvg");if(smileySvg)smileySvg.style.fill=currentWidget.trigger_font_color<7?"#"+currentWidget.trigger_font_color:currentWidget.trigger_font_color;add_event(document.getElementById("countly-feedback-sticker-"+currentWidget._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+currentWidget._id).style.display="block";document.getElementById("cfbg").style.display="block"})}else{document.getElementById("countly-iframe-wrapper-"+currentWidget._id).style.display="block";document.getElementById("cfbg").style.display="block"}}catch(e){log("Somethings went wrong while element injecting process: "+e)}}function reportViewDuration(){if(lastView){var segments={name:lastView,segment:platform};if(Countly.check_consent("views")){add_omt_events({key:"[OMT]_view",dur:getTimestamp()-lastViewTime,segmentation:segments})}lastView=null}}function getReferrer(){var referer="";try{referer=window.document.referrer}catch(e){if(window.parent){try{referer=window.parent.document.referrer}catch(e2){referer=""}}}if(referer===""){referer=document.referrer}return referer.toString()}function getLastView(){return lastView}function toRequestQueue(request){if(Countly.ignore_visitor){return}if(!Countly.app_key||!Countly.device_id){log("app_key or device_id is missing");return}request.app_key=Countly.app_key;request.app_version=Countly.app_version;request.device_id=Countly.device_id;request.sdk_name=SDK_NAME;request.sdk_version=SDK_VERSION;if(Countly.check_consent("location")){if(Countly.country_code){request.country_code=Countly.country_code}if(Countly.city){request.city=Countly.city}if(Countly.ip_address!==null){request.ip_address=Countly.ip_address}}else{request.location=""}request.timestamp=getMsTimestamp();var date=new Date;request.hour=date.getHours();request.dow=date.getDay();if(requestQueue.length>queueSize){requestQueue.shift()}requestQueue.push(request);store("omt_queue",requestQueue,true)}function heartBeat(){if(Countly.ignore_visitor){hasPulse=false;return}hasPulse=true;notifyLoaders();var i=0;if(typeof Countly.q!=="undefined"&&Countly.q.length>0){var req;var q=Countly.q;Countly.q=[];for(i=0;i<q.length;i++){req=q[i];log("Processing queued call",req);if(typeof req==="function"){req()}else if(req.constructor===Array&&req.length>0){if(typeof Countly[req[0]]!=="undefined"){Countly[req[0]].apply(null,req.slice(1))}else{var userdata=req[0].replace("userData.","");if(typeof Countly.userData[userdata]!=="undefined"){Countly.userData[userdata].apply(null,req.slice(1))}}}}}if(sessionStarted&&autoExtend&&trackTime){var last=getTimestamp();if(last-lastBeat>sessionUpdate){Countly.session_duration(last-lastBeat);lastBeat=last}}if(eventQueue.length>0){if(eventQueue.length<=maxEventBatch){toRequestQueue({events:JSON.stringify(eventQueue)});eventQueue=[]}else{var events=eventQueue.splice(0,maxEventBatch);toRequestQueue({events:JSON.stringify(events)})}store("omt_event",eventQueue)}if(requestQueue.length>0&&readyToProcess&&getTimestamp()>failTimeout){readyToProcess=false;var params=requestQueue.shift();if(hasAnyProperties(syncConsents)){if(consentTimer){clearTimeout(consentTimer);consentTimer=null}params.consent=JSON.stringify(syncConsents);syncConsents={}}log("Processing request",params);sendXmlHttpRequest(Countly.url+apiPath,params,function(err,params){log("Request Finished",params,err);if(err){requestQueue.unshift(params);failTimeout=getTimestamp()+failTimeoutAmount}store("omt_queue",requestQueue,true);readyToProcess=true})}setTimeout(heartBeat,beatInterval)}function getId(){return store("omt_id")||generateUUID()}function generateUUID(){var d=(new Date).getTime();var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c==="x"?r:r&3|8).toString(16)});return uuid}function getMetrics(){var metrics={};metrics._app_version=Countly.app_version;metrics._ua=navigator.userAgent;if(screen.width){var width=screen.width?parseInt(screen.width):0;var height=screen.height?parseInt(screen.height):0;if(width!==0&&height!==0){var iOS=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);if(iOS&&window.devicePixelRatio){width=Math.round(width*window.devicePixelRatio);height=Math.round(height*window.devicePixelRatio)}else{if(Math.abs(window.orientation)===90){var temp=width;width=height;height=temp}}metrics._resolution=""+width+"x"+height}}if(window.devicePixelRatio){metrics._density=window.devicePixelRatio}var locale=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;if(typeof locale!=="undefined"){metrics._locale=locale}if(typeof document.referrer!=="undefined"&&document.referrer.length){var matches=urlParseRE.exec(document.referrer);if(matches&&matches[11]&&matches[11]!==window.location.hostname){var ignoring=false;if(ignoreReferrers&&ignoreReferrers.length){for(var k=0;k<ignoreReferrers.length;k++){try{var reg=new RegExp(ignoreReferrers[k]);if(reg.test(document.referrer)){log("Ignored:",document.referrer);ignoring=true;break}}catch(ex){log("Problem with regex",ignoreReferrers[k])}}}if(!ignoring){metrics._store=document.referrer}}}log("Got metrics",metrics);return metrics}function log(){if(Countly.debug&&typeof console!=="undefined"){if(arguments[1]&&typeof arguments[1]=="object"){arguments[1]=JSON.stringify(arguments[1])}console.log(Array.prototype.slice.call(arguments).join("\n"))}}function getTimestamp(){return Math.floor((new Date).getTime()/1e3)}function getMsTimestamp(){var ts=(new Date).getTime();if(lastMsTs>=ts){lastMsTs++}else{lastMsTs=ts}return lastMsTs}function recordError(err,nonfatal,segments){if(Countly.check_consent("crashes")&&err){segments=segments||crashSegments;var error="";if(typeof err==="object"){if(typeof err.stack!=="undefined"){error=err.stack}else{if(typeof err.name!=="undefined"){error+=err.name+":"}if(typeof err.message!=="undefined"){error+=err.message+"\n"}if(typeof err.fileName!=="undefined"){error+="in "+err.fileName+"\n"}if(typeof err.lineNumber!=="undefined"){error+="on "+err.lineNumber}if(typeof err.columnNumber!=="undefined"){error+=":"+err.columnNumber}}}else{error=err+""}nonfatal=nonfatal?true:false;var metrics=getMetrics();var ob={_resolution:metrics._resolution,_error:error,_app_version:metrics._app_version,_run:getTimestamp()-startTime};ob._not_os_specific=true;var battery=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery;if(battery){ob._bat=Math.floor(battery.level*100)}if(typeof navigator.onLine!=="undefined"){ob._online=navigator.onLine?true:false}ob._background=document.hasFocus()?false:true;if(crashLogs.length>0){ob._logs=crashLogs.join("\n")}crashLogs=[];ob._nonfatal=nonfatal;ob._view=(window.location.pathname||"")+(window.location.search||"")+(window.location.hash||"");if(typeof segments!=="undefined"){ob._custom=segments}try{var canvas=document.createElement("canvas");var gl=canvas.getContext("experimental-webgl");ob._opengl=gl.getParameter(gl.VERSION)}catch(ex){}toRequestQueue({crash:JSON.stringify(ob)})}}function sendXmlHttpRequest(url,params,callback){try{log("Sending XML HTTP request");var xhr=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;params=params||{};var data=prepareParams(params);var method="GET";if(Countly.force_post||data.length>=2e3){method="POST"}if(method==="GET"){xhr.open("GET",url+"?"+data,true)}else{xhr.open("POST",url,true);xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded")}xhr.onreadystatechange=function(){if(this.readyState===4&&this.status>=200&&this.status<300){if(typeof callback==="function"){callback(false,params,this.responseText)}}else if(this.readyState===4){log("Failed Server XML HTTP request",this.status);if(typeof callback==="function"){callback(true,params)}}};if(method==="GET"){xhr.send()}else{xhr.send(data)}}catch(e){log("Failed XML HTTP request",e);if(typeof callback==="function"){callback(true,params)}}}function prepareParams(params){var str=[];for(var i in params){str.push(i+"="+encodeURIComponent(params[i]))}return str.join("&")}function stripTrailingSlash(str){if(str.substr(str.length-1)==="/"){return str.substr(0,str.length-1)}return str}function getProperties(orig,props){var ob={};var prop;for(var i=0;i<props.length;i++){prop=props[i];if(typeof orig[prop]!=="undefined"){ob[prop]=orig[prop]}}return ob}if(!Element.prototype.closest){Element.prototype.closest=function(nodeName){var el=this;nodeName=nodeName.toUpperCase();while(el){if(el.nodeName.toUpperCase()===nodeName){return el}el=el.parentElement}}}var add_event=function(element,type,listener){if(typeof element.addEventListener!=="undefined"){element.addEventListener(type,listener,false)}else{element.attachEvent("on"+type,listener)}};var get_event_target=function(event){if(!event){return window.event.srcElement}else if(typeof event.target!=="undefined"){return event.target}else{return event.srcElement}};var detect_device=function(){var b=navigator.userAgent.toLowerCase(),a=function(a){if(a){b=(a+"").toLowerCase()}return/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(b)?"tablet":/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/.test(b)?"phone":"desktop"};return{device:a(),detect:a,isMobile:"desktop"!==a()?!0:!1,userAgent:b}}();function get_page_coord(e){if(typeof e.pageY=="undefined"&&typeof e.clientX=="number"&&document.documentElement){e.pageX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;e.pageY=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}return e}function getDocHeight(){var D=document;return Math.max(Math.max(D.body.scrollHeight,D.documentElement.scrollHeight),Math.max(D.body.offsetHeight,D.documentElement.offsetHeight),Math.max(D.body.clientHeight,D.documentElement.clientHeight))}function getDocWidth(){var D=document;return Math.max(Math.max(D.body.scrollWidth,D.documentElement.scrollWidth),Math.max(D.body.offsetWidth,D.documentElement.offsetWidth),Math.max(D.body.clientWidth,D.documentElement.clientWidth))}function getViewportHeight(){var D=document;return Math.min(Math.min(D.body.clientHeight,D.documentElement.clientHeight),Math.min(D.body.offsetHeight,D.documentElement.offsetHeight),window.innerHeight)}function setToken(token){store("omt_token",token)}function getToken(){var token=store("omt_token");store("omt_token",null);return token}function hasAnyProperties(ob){if(ob){for(var prop in ob){return true}}return false}var store=function store(key,value,storageOnly){storageOnly=storageOnly||false;var lsSupport=false,data;lsSupport=true;try{if(typeof localStorage!=="undefined"){localStorage.setItem("testLocal",true)}}catch(e){lsSupport=false}if(typeof value!=="undefined"&&value!==null){if(typeof value==="object"){value=JSON.stringify(value)}if(lsSupport){localStorage.setItem(key,value)}else if(!storageOnly){createCookie(key,value,30)}}if(typeof value==="undefined"){if(lsSupport){data=localStorage.getItem(key)}else if(!storageOnly){data=readCookie(key)}try{data=JSON.parse(data)}catch(e){}return data}if(value===null){if(lsSupport){localStorage.removeItem(key)}else if(!storageOnly){createCookie(key,"",-1)}}function createCookie(key,value,exp){var date=new Date;date.setTime(date.getTime()+exp*24*60*60*1e3);var expires="; expires="+date.toGMTString();document.cookie=key+"="+value+expires+"; path=/"}function readCookie(key){var nameEQ=key+"=";var ca=document.cookie.split(";");for(var i=0,max=ca.length;i<max;i++){var c=ca[i];while(c.charAt(0)===" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)===0){return c.substring(nameEQ.length,c.length)}}return null}};function loadFile(tag,attr,type,src,data,callback){var fileref=document.createElement(tag),loaded;fileref.setAttribute(attr,type);fileref.setAttribute(src,data);if(callback){fileref.onreadystatechange=fileref.onload=function(){if(!loaded){callback()}loaded=true}}document.getElementsByTagName("head")[0].appendChild(fileref)}function loadJS(js,callback){loadFile("script","type","text/javascript","src",js,callback)}function loadCSS(css,callback){loadFile("link","rel","stylesheet","href",css,callback)}function showLoader(){var loader=document.getElementById("cly-loader");if(!loader){log("setting up loader");var css="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}"+"#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}"+"@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}",head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css";if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}head.appendChild(style);loader=document.createElement("div");loader.setAttribute("id","cly-loader");document.body.appendChild(loader)}loader.style.display="block"}function hideLoader(){var loader=document.getElementById("cly-loader");if(loader){loader.style.display="none"}}Countly._internals={store:store,getDocWidth:getDocWidth,getDocHeight:getDocHeight,getViewportHeight:getViewportHeight,get_page_coord:get_page_coord,get_event_target:get_event_target,add_event:add_event,getProperties:getProperties,stripTrailingSlash:stripTrailingSlash,prepareParams:prepareParams,sendXmlHttpRequest:sendXmlHttpRequest,recordError:recordError,getMsTimestamp:getMsTimestamp,getTimestamp:getTimestamp,log:log,getMetrics:getMetrics,generateUUID:generateUUID,getId:getId,heartBeat:heartBeat,toRequestQueue:toRequestQueue,reportViewDuration:reportViewDuration,loadJS:loadJS,loadCSS:loadCSS,getLastView:getLastView,setToken:setToken,getToken:getToken,showLoader:showLoader,hideLoader:hideLoader,add_omt_events:add_omt_events,detect_device:detect_device};return Countly})(window.Countly=window.Countly||{});(function(_rmta){_rmta=_rmta||{};_rmta.server=_rmta.server||"https://api.analytics.rmtyun.com/";_rmta.mediaTypeList=["content","content_live","pics","video","audio","tv_live","tv_relive","radio_live","radio_relive"];_rmta.log=function(msg,type){type=type?"[info]":"[err]";console.log(type+msg)};_rmta.inArray=function(arr,v){for(var i=0;i<arr.length;i++){if(v===arr[i]){return true}}return false};_rmta.getPageTitle=function(){return document.title};_rmta.getReferrer=function(){var referrer="";try{referrer=window.document.referrer}catch(e){if(window.parent){try{referrer=window.parent.document.referrer}catch(e2){referrer=""}}}if(referrer===""){referrer=document.referrer}return referrer.toString()};_rmta.init=function(app_key,app_version,tracks,properties){var ob={app_key:app_key,url:_rmta.server,app_version:app_version?app_version:"0.0"};if(properties){Object.keys(properties).forEach(function(key){ob[key]=properties[key]})}Countly.init(ob);Countly.track_sessions();Countly.track_pageview();if(tracks){for(var i=0;i<tracks.length;i++){if(tracks[i]==="track_clicks"){Countly.track_clicks()}if(tracks[i]==="track_links"){Countly.track_links()}if(tracks[i]==="track_forms"){Countly.track_forms()}}}};_rmta.mediaView=function(obj){if(typeof obj!=="object"){this.log("mediaView参数配置错误");return false}if(!obj.type){this.log("mediaView参数配置错误");return false}Countly.q.push(["add_event",{key:"[OMT]_media_view",segmentation:{type:obj.type,title:obj.hasOwnProperty("title")?obj.title:document.title,cat_id:obj.hasOwnProperty("cat_id")?obj.cat_id:"",content_id:obj.hasOwnProperty("content_id")?obj.content_id:"",channel:obj.hasOwnProperty("channel")?obj.channel:"",is_push:obj.hasOwnProperty("is_push")?obj.is_push:0,segmentation:obj.hasOwnProperty("segmentation")?obj.segmentation:""}}])};_rmta.userDetails=function(obj){if(typeof obj!=="object"){this.log("userDetails参数配置错误");return false}Countly.q.push(["user_details",{username:obj.hasOwnProperty("username")?obj.username:"",nickname:obj.hasOwnProperty("nickname")?obj.nickname:"",mobile:obj.hasOwnProperty("mobile")?obj.mobile:"",segmentation:obj.hasOwnProperty("segmentation")?obj.segmentation:""}])};_rmta.event=function(key,obj){if(!key||!obj){this.log("自定义事件参数错误");return false}if(typeof obj!=="object"){this.log("自定义事件参数错误");return false}Countly.q.push(["add_event",{key:"[OMT]_action",segmentation:{key:key,segmentation:obj}}])};return _rmta})(window._rmta=window._rmta||{});