try{document.domain="tvsou.com"}catch(e){};var isLogin=false;var userid = "";function login(token){$("head").append('<script type="text/javascript" src="https://ap.haokan.com/account?type=login&isReturn=1&token='+token+'"/>');$("head").append('<script type="text/javascript" src="https://ap.tvsou.com/account?type=login&isReturn=1&token='+token+'"/>')}function loginCallback(){window.location.reload()}function setCookie(name,value){var Days=30;var exp=new Date();exp.setTime(exp.getTime()+Days*24*60*60*1000);document.cookie=name+"="+escape(value)+";expires="+exp.toGMTString()}function getCookie(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");if(arr=document.cookie.match(reg)){return unescape(arr[2])}else{return""}}function delCookie(name){var exp=new Date();exp.setTime(exp.getTime()-1);var cval=getCookie(name);if(cval!=""){document.cookie=name+"="+cval+";expires="+exp.toGMTString()}}$(function(){$(".img-main-info").hover(function(){$(this).children(".img-info").children("input").show()},function(){$(this).children(".img-info").children("input").hide()})});function onFavor(url,groupid,id,val,obj,obj2){var postData={"linkid":id,"groupid":groupid,"viewpoint":val};$.ajax({type:"POST",data:postData,url:url,dataType:"json",success:function(data){if(data.status=="1"){var num=0;var thisnum=$(obj).html();if(thisnum!=""){num=Number(thisnum)}$(obj).html(num+1);if(data.edit=="yes"){num=0;thisnum=$(obj2).html();if(thisnum!=""){num=Number(thisnum)}if(num>0){$(obj2).html(num-1)}}}else{layer.msg(data.msg,{time:1000})}}})}function submitComment(url,groupid,linkid,content,mpreid,preid){var postData={"groupid":groupid,"linkid":linkid,"content":content,"mpreid":mpreid,"preid":preid};$.ajax({type:"POST",data:postData,url:url,async:false,dataType:"json",xhrFields:{withCredentials:true},crossDomain:true,success:function(data){if(data.status=="1"){layer.msg(data.msg,{time:1000},function(){location.reload()})}else{if(data.status=="99"){userLogin()}else{layer.msg(data.msg,{time:1000})}}}})}function setLocalStorage(key,val){localStorage.setItem(key,val)}function getLocalStorage(key){var val=localStorage.getItem(key);if(val){return val}else{return""}}function compareDate(st,et){var dataA=new Date(st);var dataB=new Date(et);var t=(dataB.getTime()-dataA.getTime())/1000/60;return t}function localStorExpire(){var myDate=new Date();var nowTime=myDate.toLocaleDateString();var localTime=getLocalStorage("localStorTime");if(localTime==""){setLocalStorage("localStorTime",nowTime)}else{var t=compareDate(localTime,nowTime);if(t>=720){localStorage.clear();setLocalStorage("localStorTime",nowTime)}}}localStorExpire();var thirdPartyBindHtml="<style>"+".gt_holder.popup .gt_popup_wrap {"+"z-index: 999999999;"+"border: 1px solid #f5f5f5;"+"}"+".gt_mask{"+"z-index: 999999998;"+" }"+".gt_holder.gt_popup .gt_popup_wrap {"+"z-index: 999999999;"+" }"+" .active-line{"+" border: 0px!important;"+" }"+".active-line input{"+"border: 1px solid #e01b3c!important;"+" }"+"</style>"+'<div class="impression-box relative border-radius-10">'+'<div class=" ov">'+"</div>"+'<div class="set-box-tc">'+'<form action="" id="bindAccForm" method="post" onsubmit="return false">'+"<ol>"+'<li class="redact-info relative" style="margin: 60px 0 14px 0;">'+'<div class="borer-5 color-c account-div" style="width: 280px;">'+'<input type="text" class="name-input borer-5 color-3" name="bind_account" id="bind_account" value="" placeholder="请输入绑定帐号(手机号或邮箱)" style="width: 250px;">'+"</div>"+' <p class="font-12 error account-error" style="margin-left: 0; margin-top: 5px;"></p>'+"</li>"+'<li class="redact-info">'+'<div class="borer-5 color-c code-div" style="width: 150px;float: left">'+'<input type="text" class="name-input borer-5 color-c" id="bind_code" name="bind_code" value="" placeholder="请输入验证码" style="width:120px;">'+"</div>"+'<input type="button" value="发送验证码" data-time="0" id="bind_send_code"  class="color-9 input-tc input-yz text-c borer-5 cur send-code">'+'<p class="font-12 error code-error" style="margin-left: 0; margin-top: 5px;"></p>'+"</li>"+' <li class="redact-info">'+'<input type="button" value="绑定" class="color-9 input-tc text-c borer-5 cur btn-all" id="bind_submit">'+"</li>"+"</ol>"+"</form>"+"</div>"+'<div id="popup-captcha"></div>'+"</div>";function thirdPartyBindCallback(url){if(url==""){window.location.reload()}else{window.location.href=url}}function thirdBindCallback(geetest_challenge,geetest_validate,geetest_seccode){var account=$("#bind_account").val();var th=$("#bind_send_code");$.ajax({type:"POST",url:"/tvsou/My/ajaxDoSendCodeBd",data:{account:account,geetest_challenge:geetest_challenge,geetest_validate:geetest_validate,geetest_seccode:geetest_seccode},dataType:"json",success:function(data){if(data.status=="1"){$(th).removeClass("input-active");$(th).attr("data-time","60");$(th).val("重新发送(60s)");codeTimeout(th)}else{if(data.status=="2"){$("#bind_account").parent().siblings("p").html(data.msg)}else{layer.msg(data.msg,{time:1000})}}},error:function(){layer.msg("系统错误请联系管理员",{time:1000})}})}function codeTimeout(obj){v=parseInt($(obj).attr("data-time"));if(v>1){v=v-1;$(obj).attr("data-time",v);$(obj).val("重新发送("+v+"s)");setTimeout(function(){codeTimeout(obj)},1000)}else{if($(obj).attr("id")=="register_send_code"){$("#register_code_msg").attr("style","");$("#register_code_msg").html("")}$(obj).val("发送验证码");$(obj).attr("data-time",0)}}function thirdBindReload(){$("#bind_account").bind({keyup:function(){var val=$(this).val();$("#bind_send_code").removeClass("input-active");if(val!=""){$("#bind_send_code").addClass("input-active")}else{$("#bind_account").parent().addClass("active-line");$("#bind_account").parent().siblings("p").html("请输入绑定帐号(手机号或邮箱)")}},blur:function(){var val=$(this).val();$("#bind_send_code").removeClass("input-active");if(!/^0?1[3|4|5|7|8][0-9]\d{8}$/.test(val)&&!/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(val)){$("#bind_account").parent().addClass("active-line");$("#bind_account").parent().siblings("p").html("请输入绑定帐号(手机号或邮箱)");return false}if(val!=""){$("#bind_send_code").addClass("input-active")}}});$("#bind_send_code").click(function(){if($(this).hasClass("input-active")){var account=$("#bind_account").val();if(!/^0?1[3|4|5|7|8][0-9]\d{8}$/.test(account)&&!/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(account)){$("#bind_account").parent().addClass("active-line");$("#bind_account").parent().siblings("p").html("请输入绑定帐号(手机号或邮箱)");return false}appendPopupShow({callback:function(a,b,c){thirdBindCallback(a,b,c)}})}});$(".layui-layer-close").on("click",function(){window.location.reload();layer.close()});$("#bind_account,#bind_code").bind({keyup:function(){var account=$('input[name="bind_account"]').val();var code=$('input[name="bind_code"]').val();$(this).siblings("p").html("");$(this).removeClass("active-line");if(account!=""&&code!=""){$("#bind_submit").addClass("input-active")}else{$("#bind_submit").removeClass("input-active")}},blur:function(){var account=$('input[name="bind_account"]').val();var code=$('input[name="bind_code"]').val();$(this).siblings("p").html("");$(this).removeClass("active-line");if(account!=""&&code!=""){$("#bind_submit").addClass("input-active")}else{$("#bind_submit").removeClass("input-active")}}});$("#bind_submit").on("click",function(){if($(this).hasClass("input-active")){$("#bindAccForm").submit()}});var errorContent="";$("#bindAccForm").validate({rules:{account:{required:true,},code:{required:true,minlength:6,maxlength:6},},messages:{account:{required:"该信息必须填写",},code:{required:"验证码有误",minlength:"验证码有误",maxlength:"验证码有误"}},errorElement:"em",errorPlacement:function(error,element){if(errorContent==""){$(element).parent().addClass("active-line");$(element).parent().parent().find(".error").html("");error.appendTo($(element).parent().parent().find(".error"));errorContent=$(element).parent().parent().find(".error").html("")}},showErrors:function(errorMap,errorList){if(errorList.length<1){errorContent="";$(".active-line").removeClass("active-line");$(".error").html("")}else{this.defaultShowErrors()}},submitHandler:function(form){if($("#bind_submit").hasClass("input-active")){var account=$('input[name="bind_account"]').val();var code=$('input[name="bind_code"]').val();$.ajax({type:"POST",url:"/tvsou/My/ajaxDoUpdateBind",data:{account:account,code:code},dataType:"json",xhrFields:{withCredentials:true},success:function(rec){if(rec.status=="1"){layer.msg(rec.msg,{time:1000});try{if(typeof(loginCallback)!="undefined"){loginCallback()}}catch(e){window.location.reload()}layer.closeAll()}else{if(rec.status=="2"){$("#bind_code").parent().addClass("active-line");$("#bind_code").parent().siblings("p").html(rec.msg)}else{if(rec.status=="3"){$("#bind_account").parent().addClass("active-line");$("#bind_account").parent().siblings("p").html(rec.msg)}else{layer.msg(rec.msg,{time:1000})}}}},error:function(){layer.msg("系统错误请联系管理员",{time:1000})}})}}})}function countView(id){$.ajax({type:"POST",data:{"id":id},url:"/tvsou/count/ajaxDoView",dataType:"json",success:function(data){}})}function isLoginf(){ if(isLogin==true) return false; $.ajax({type:"POST",url:"/login/ajaxIsLogin",dataType:"json",success:function(data){if(data.status=="1"){isLogin=true;}}})}